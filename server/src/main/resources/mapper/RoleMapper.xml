<!-- RoleMapper.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.olivin.app.auth.mapper.RoleMapper">

    <!-- Result Map -->
    <resultMap id="RoleResultMap" type="com.olivin.app.auth.service.RoleVO">
        <id property="roleId" column="ROLE_ID"/>
        <result property="roleName" column="ROLE_NAME"/>
        <result property="field" column="FIELD"/>
    </resultMap>

    <!-- 역할 ID로 조회 -->
    <select id="findByRoleId" parameterType="long" resultMap="RoleResultMap">
        SELECT 
            ROLE_ID,
            ROLE_NAME,
            FIELD
        FROM ROLES
        WHERE ROLE_ID = #{roleId}
    </select>

    <!-- 역할 이름으로 조회 -->
    <select id="findByRoleName" parameterType="string" resultMap="RoleResultMap">
        SELECT 
            ROLE_ID,
            ROLE_NAME,
            FIELD
        FROM ROLES
        WHERE ROLE_NAME = #{roleName}
    </select>

    <!-- 모든 역할 조회 -->
    <select id="findAllRoles" resultMap="RoleResultMap">
        SELECT 
            ROLE_ID,
            ROLE_NAME,
            FIELD
        FROM ROLES
        ORDER BY ROLE_ID
    </select>

    <!-- 역할별 권한 목록 조회 -->
    <select id="findPermissionsByRoleId" parameterType="long" resultType="com.olivin.app.auth.service.PermissionVO">
        SELECT 
            p.PERM_ID as permId,
            p.PERM_NAME as permName,
            p.PERM_DESCRIPTION as permDescription
        FROM PERMISSIONS p
        INNER JOIN ROLE_PERMISSION rp ON p.PERM_ID = rp.PERM_ID
        WHERE rp.ROLE_ID = #{roleId}
        ORDER BY p.PERM_ID
    </select>

</mapper>