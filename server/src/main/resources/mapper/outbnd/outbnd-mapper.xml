<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.olivin.app.outbnd.mapper.OutbndMapper">
    <!-- Interface의 메서드를 통해 실행할 쿼리 정의 -->
    <select id="selectAllList" resultType="OutbndVO">
        SELECT outbnd_no
            , order_id
            , order_title
            , outbnd_from
            , inbnd_to
            , outbnd_date
            , outbnd_status
        FROM  outbnd
    </select>
    <select id="selectCodeForUpdate" resultType="String">
        SELECT
            'OUT' || TO_CHAR(SYSDATE, 'YYYYMMDD') ||
            LPAD(NVL(MAX(TO_NUMBER(SUBSTR(outbnd_no, LENGTH('OUT' || TO_CHAR(SYSDATE, 'YYYYMMDD')) + 1))), 0) + 1, 3, '0') as "res"
        FROM outbnd
        WHERE outbnd_no LIKE 'OUT' || TO_CHAR(SYSDATE, 'YYYYMMDD') || '%' 
    </select>
    <update id="callProcHqOutbndProcess" parameterType="string" statementType="CALLABLE">
        {CALL proc_hq_outbnd_process(#{orderId, mode=IN, jdbcType=VARCHAR})}
    </update>
    <update id="callProcSubOutbndProcess" parameterType="string" statementType="CALLABLE">
        {CALL proc_vendor_outbnd_process(#{orderId, mode=IN, jdbcType=VARCHAR})}
    </update>
</mapper>